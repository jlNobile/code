<!DOCTYPE>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="myStyle.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.min.js"></script>
	<script src="myJS.js"></script>
</head>
<body>
	<div id="budgetInfo">
		<div id="budget">
			<h1>My Budget</h1>
				<form>
					<fieldset>
						<legend>Income Information</legend>
						<label for="income">Income:</label><input type="text" name="income" id="income" value="0"><br>
					</fieldset>
					<fieldset id="budgetValues" onchange="budgetTotal()">
						<legend>Expense Information</legend>
						<label for="rent">Mortgage/Rent:</label><input type="text" id="rent" name="budVal" value="0"><br>
						<label for="utilities">Utilities:</label><input type="text" id="utilities" name="budVal" value="0"><br>
						<label for="insurance">Insurance:</label><input type="text" id="insuranace" name="budVal" value="0"><br>
						<label for="phone">Phone:</label><input type="text" id="phone" name="budVal" value="0"><br>
						<label for="food">Groceries:</label><input type="text" id="food" name="budVal" value="0"><br>
						<label for="gas">Gas:</label><input type="text" id="gas" name="budVal" value="0"><br>
						<label for="entertainment">Entertainment:</label><input type="text" id="entertainment" name="budVal" value="0"><br>
					</fieldset>
					<fieldset>
						<legend>Monthly Totals</legend>
						<label for="total">Total:</label><input type="text" id="total" name="total" value="0"><br>
						<label for="endingBalance">Balance:</label><input type="text" id="endingBalance" name="endingBalance" value="0"><br>
					</fieldset>
				</form>
		</div>
		<div id="budgetPercent">
			<h1>My Budget Percent</h1>
		</div>
	</div>
	<div id="transAmount" class="floatLeft">
		<div onload="expenseChart()">
			<h1>Transaction Amounts By Catagory</h1>
			<script>

				var outer = {width: 500, height: 500};
				var margin = {left: 80, right: 30, top: 30, bottom: 30};
				var inner = {width: outer.width - margin.left - margin.right, height: outer.height - margin.top - margin.bottom};
				//var radius = {min: 2, max: 6};
				//var column = {x: "sumCategories.key", y: "sumCategories.value", color: "sumCategories.key"};
				var barPadding = 0.2;

				var svg = d3.select("body").append("svg")
					.attr("width", outer.width)
					.attr("height", outer.height);

				var g = svg.append("g")
					.attr("transform", "translate(" + margin.left + ", " + margin.top + ")");
				var yAxisG = g.append("g")
					.attr("transform", "translate(0 ," + inner.width +")")
					.attr("transform", "rotate(-90");
				var xAxisG = g.append("g");

				var yScale = d3.scaleBand()
					.range([0, inner.width])
					.padding(barPadding);
				var xScale = d3.scaleLinear()
					.range([0, inner.height]);

				var xAxis = d3.axisTop(xScale);
				var yAxis = d3.axisLeft(yScale);

				//var rScale = d3.scaleLinear().range([radius.min, radius.max]);
				var colorScale = d3.scaleOrdinal(d3.schemeCategory20);
				
				function render(data) {

					var sumCategories = d3.nest() 
						.key(function(d) {return d.category})
						.rollup(function(d) {
							return d3.sum(d, function(g) {return +g.amount})
						})
						.entries(data);
					/*console.log(sumCategories);
					for(var i = 0; i < sumCategories.length; i++) {
						console.log(sumCategories[i].key);
					}*/
					/*data.forEach(function(d) {
						d[column.y] = +d[column.y];
						console.log(d[column.y]);
					});*/
					//console.log(data);

					xScale.domain([0, d3.max(sumCategories, function(d){return +d.value})]);
					//console.log(d3.max(sumCategories, function(sumCategories){return +sumCategories.value}));
					//console.log(yScale);
					yScale.domain(sumCategories.map(function(d){return d.key}));
					//console.log(xScale);
					//rScale.domain(d3.extent(data, function(d){return +d[column.radius]}));
					
					xAxisG.call(xAxis);
					yAxisG.call(yAxis);

					var rects = g.selectAll("rect").data(sumCategories);
					rects.enter().append("rect")
						.attr("height", yScale.bandwidth())
					.merge(rects)
						.attr("y", (sumCategories, function(d){return yScale(d.key);}))
						.attr("x", (sumCategories, function(d){return xScale(d.value);}))
						.attr("width", (sumCategories, function(d){return xScale(d.value) - inner.height;}))
						.style("fill", (sumCategories, function(d){return colorScale(d.key)}));

					rects.exit().remove();
				}

				d3.csv("expensesSept2.csv", render);
			</script>
		</div>
	</div>
	<br>
	<div id="transRecord">
		<h1>Transaction Record</h1>
	</div>
</body>
</html>